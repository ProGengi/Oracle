#
#
#
#
#

files generates when create database:
 1.Data files and temp files
 2.control files
 3.online redo log files
 
mechanism of storing database files:
 1.Oracle Automatic Storage Management (Oracle ASM)
 2.Operating system file system
 3.Raw device(裸设备)
 4.Cluster file system
 
数据库可以采用混合的方式存储数据库文件。

ASM:
 
 
data file：
 每个数据库至少有一个数据文件。
 
 表空间跟数据文件关系：
  1.表空间可以有多个数据文件。
  2.一个段可以跨越一个或者多个数据文件，但是不可以跨越多个表空间。
  3.数据库必须要有的两个表空间：system sysaux。当创建数据库时，自动为system表空间分配一个datafile。
    system表空间中包含data dictionary。

permanment and temporary datafile
permanment datafile：
temporary datafile：存储会话期间的模式对象。
temporary tablespace 中有temporary datafile 在hash，sort等操作时使用。当内存空间不足时，临时文件也存储结果数据。

永久数据文件与临时文件的差异：
1.永久的数据对象不会存到临时文件中。
2.临时文件的模式被设置成nologging，也就意味着没有redo log。
3.不能将临时文件设置为只读
4.不能用alter database 语句来创建tempfile
5.When you create or resize temp files, they are not always guaranteed allocation of disk space for the file size specified。
  On file systems such as Linux and UNIX, temp files are created as sparse files. 
  In this case, disk blocks are allocated not at file creation or resizing, but as the blocks are accessed for the first time.
  当您创建或调整临时文件时，它们并不总是保证指定文件大小的磁盘空间分配。
6.临时文件的相关信息在dba_temp_files和dynamic performance view V$tempfile中。  
  
online and offline datafile：
 每个数据文件都是online(可用)或者offline(不可用)的。offline datafile 不可以访问。
 使datafile offline的原因有很多：脱机备份，重命名数据文件，块损坏。当数据库不能对数据文件进行写操作时，会自动将数据文件offline。
 表空间也是有online，offline的，当给一个datafile置为offline后，所在的表空间还是online。通过将表空间本省不可用，来让所有数据文件不可用。
 
数据文件的结构：
 data file header：包括的元数据有，文件的大小，检查点SCN.
 每个头文件包含一个绝对文件号和一个相对文件号。绝对文件号唯一标识数据库中的数据文件。相对文件号唯一标识表空间中的数据文件。
 
control files：
 一个数据库只有一个控制文件，但是可以有多个备份。
 控制文件是用来找到数据文件和管理数据库的根文件。
 控制文件包括的内容：
  1.The database name and database unique identifier (DBID)
  2.The time stamp of database creation
  3.Information about data files, online redo log files, and archived redo log files
  4.Tablespace information
  5.RMAN backups
 控制文件用于以下目的：
  1.包含数据库所需要的数据文件，在线重做日志文件等。
  For example, when an administrator adds, renames, or drops a data file or online redo log file, the database updates the control file to reflect this change.
  2.它包含在数据库未打开时必须访问的元数据。
 
 If a control file becomes unusable, then the database instance fails when it attempts to access the damaged control file. 
 When other current control file copies exist, the database can be remounted and opened without media recovery. 
 If all control files of a database are lost, however, then the instance fails and media recovery is required. 
 Media recovery is not straightforward if an older backup of a control file must be used because a current copy is not available.
 
 控制文件的相关信息都可以在V$中找到。
 
 
 Online Redo Log
  after an instance failure the online redo log files enable Oracle Database to recover committed data not yet written to the data files.
  数据库将每个事务同步到redo log buffer，将来redo log buffer 会写到日志文件。
  Oracle数据库至少需要两个文件以保证一个随时可写而另一个被归档（如果数据库是ARCHIVELOG模式）。
  同一时间只会有一个日志文件被写，这个文件叫做current online redo log file.
  日志文件的切换发生在一个写完要切换到另一个文件的时候。
  
  
